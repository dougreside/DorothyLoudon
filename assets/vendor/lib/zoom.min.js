/* turn.js 4.0.9 | Copyright (c) 2012 Emmanuel Garcia | turnjs.com | turnjs.com/license.txt */

(function(f){function q(a,b){return a[0]==b[0]?!1:a.attr("page")?!0:a.parent()[0]?q(a.parent(),b):!1}function t(a){function b(a){this.name="TurnJsError";this.message=a}b.prototype=Error();b.prototype.constructor=b;return new b(a)}function s(a,b,c){return p&&c?" translate3d("+a+"px,"+b+"px, 0px) ":" translate("+a+"px, "+b+"px) "}function u(a,b){return p&&b?" scale3d("+a+", "+a+", 1) ":" scale("+a+") "}function i(a,b){return{x:a,y:b}}function m(a,b){return function(){return a.apply(b,arguments)}}var p,
v={max:2,flipbook:null,easeFunction:"ease-in-out",duration:500,when:{}},g={init:function(a){var b=this,c=this.data(),a=f.extend({},v,a);if(!a.flipbook||!a.flipbook.turn("is"))throw t("options.flipbook is required");p="WebKitCSSMatrix"in window||"MozPerspective"in document.body.style;if("function"!=typeof a.max){var e=a.max;a.max=function(){return e}}c.zoom={opts:a,axis:i(0,0),scrollPos:i(0,0),eventQueue:[],mouseupEvent:function(){return g._eMouseUp.apply(b,arguments)},eventTouchStart:m(g._eTouchStart,
b),eventTouchMove:m(g._eTouchMove,b),eventTouchEnd:m(g._eTouchEnd,b),flipbookEvents:{zooming:m(g._eZoom,b),pressed:m(g._ePressed,b),released:m(g._eReleased,b),start:m(g._eStart,b),turning:m(g._eTurning,b),turned:m(g._eTurned,b),destroying:m(g._eDestroying,b)}};for(var d in a.when)Object.prototype.hasOwnProperty.call(a.when,d)&&this.bind("zoom."+d,a.when[d]);for(d in c.zoom.flipbookEvents)Object.prototype.hasOwnProperty.call(c.zoom.flipbookEvents,d)&&a.flipbook.bind(d,c.zoom.flipbookEvents[d]);this.css({position:"relative",
overflow:"hidden"});f.isTouch?(a.flipbook.bind("touchstart",c.zoom.eventTouchStart).bind("touchmove",c.zoom.eventTouchMove).bind("touchend",c.zoom.eventTouchEnd),this.bind("touchstart",g._tap)):this.mousedown(g._mousedown).click(g._tap)},_tap:function(a){var b=f(this),c=b.data().zoom;!c.draggingCorner&&!c.dragging&&q(f(a.target),b)&&(g._addEvent.call(b,"tap",a),(a=g._eventSeq.call(b))&&b.trigger(a))},_addEvent:function(a,b){var c=this.data().zoom,e=(new Date).getTime();c.eventQueue.push({name:a,timestamp:e,
event:b});10<c.eventQueue.length&&c.eventQueue.splice(0,1)},_eventSeq:function(){var a=this.data().zoom.eventQueue,b=a.length-1;if(0<b&&"tap"==a[b].name&&"tap"==a[b-1].name&&a[b].event.pageX==a[b-1].event.pageX&&a[b].event.pageY==a[b-1].event.pageY&&200>a[b].timestamp-a[b-1].timestamp&&50<a[b].timestamp-a[b-1].timestamp)return f.extend(a[b].event,{type:"zoom.doubleTap"});if("tap"==a[b].name)return f.extend(a[b].event,{type:"zoom.tap"})},_prepareZoom:function(){var a,b=0,c=this.data().zoom,e=1/this.zoom("value");
a=c.opts.flipbook;var d=a.data(),g=a.offset(),k=this.offset(),j={height:a.height()},h=a.turn("view");"double"==a.turn("display")&&a.data().opts.autoCenter?h[0]?(j.width=h[1]?a.width():a.width()/2,a=i(g.left-k.left,g.top-k.top)):(j.width=a.width()/2,b=j.width,a=i(g.left-k.left+j.width,g.top-k.top)):(j.width=a.width(),a=i(g.left-k.left,g.top-k.top));c.zoomer||(c.zoomer=f("<div />",{"class":"zoomer",css:{overflow:"hidden",position:"absolute",zIndex:"1000000"}}).mousedown(function(){return false}).appendTo(this));
c.zoomer.css({top:a.y,left:a.x,width:j.width,height:j.height});k=h.join(",");if(k!=c.zoomerView){c.zoomerView=k;c.zoomer.find("*").remove();for(k=0;k<h.length;k++)if(h[k]){var l=d.pageObjs[h[k]].offset(),m=f(d.pageObjs[h[k]]);m.clone().transform("").css({width:m.width()*e,height:m.height()*e,position:"absolute",display:"",top:(l.top-g.top)*e,left:(l.left-g.left-b)*e}).appendTo(c.zoomer)}}return{pos:a,size:j}},value:function(){return this.data().zoom.opts.flipbook.turn("zoom")},zoomIn:function(a){var b=
this,c=this.data().zoom,e=c.opts.flipbook,d=c.opts.max();e.offset();var r=this.offset();if(c.scale==d)return this;e.turn("stop");var k=f.Event("zoom.change");this.trigger(k,[d]);if(k.isDefaultPrevented())return this;var j=g._prepareZoom.call(this),h=j.pos,l=i(j.size.width/2,j.size.height/2),k=f.cssPrefix(),m=f.cssTransitionEnd(),p=e.data().opts.autoCenter;c.scale=d;e.data().noCenter=!0;a="undefined"!=typeof a?"x"in a&&"y"in a?i(a.x-h.x,a.y-h.y):f.isTouch?i(a.originalEvent.touches[0].pageX-h.x-r.left,
a.originalEvent.touches[0].pageY-h.y-r.top):i(a.pageX-h.x-r.left,a.pageY-h.y-r.top):i(l.x,l.y);if(0>a.x||0>a.y||a.x>j.width||a.y>j.height)a.x=l.x,a.y=l.y;var n=i((a.x-l.x)*d+l.x,(a.y-l.y)*d+l.y),a=i(j.size.width*d>this.width()?a.x-n.x:0,j.size.height*d>this.height()?a.y-n.y:0),n=i(Math.abs(j.size.width*d-this.width()),Math.abs(j.size.height*d-this.height())),j=i(Math.min(0,j.size.width*d-this.width()),Math.min(0,j.size.height*d-this.height())),o=i(l.x*d-l.x-h.x-a.x,l.y*d-l.y-h.y-a.y);o.y>n.y?a.y=
o.y-n.y+a.y:o.y<j.y&&(a.y=o.y-j.y+a.y);o.x>n.x?a.x=o.x-n.x+a.x:o.x<j.x&&(a.x=o.x-j.x+a.x);o=i(l.x*d-l.x-h.x-a.x,l.y*d-l.y-h.y-a.y);h={};h[k+"transition"]=k+"transform "+c.opts.easeFunction+" "+c.opts.duration+"ms";var q=function(){b.trigger("zoom.zoomIn");c.zoomIn=true;c.flipPosition=i(e.css("left"),e.css("top"));e.turn("zoom",d).css({position:"absolute",margin:"",top:0,left:0});var a=e.offset();c.axis=i(a.left-r.left,a.top-r.top);if(p&&e.turn("display")=="double"&&!e.turn("view")[0])c.axis.x=c.axis.x+
e.width()/2;b.zoom("scroll",o);b.bind(f.mouseEvents.down,g._eMouseDown);b.bind(f.mouseEvents.move,g._eMouseMove);f(document).bind(f.mouseEvents.up,c.mouseupEvent);b.bind("mousewheel",g._eMouseWheel);setTimeout(function(){c.zoomer.hide();c.zoomer.remove();c.zoomer=null;c.zoomerView=null},50)};c.zoomer.css(h).show();m?c.zoomer.bind(m,function(){f(this).unbind(m);q()}):setTimeout(q,c.opts.duration);c.zoomer.transform(s(a.x,a.y,!0)+u(d,!0));return this},zoomOut:function(a){var b,c=this,e=this.data().zoom,
d=e.opts.flipbook,m=1/e.scale,k=f.cssPrefix(),j=f.cssTransitionEnd();b=this.offset();a="undefined"!=typeof a?a:e.opts.duration;if(e.zoomIn){var h=f.Event("zoom.change");this.trigger(h,[1]);if(h.isDefaultPrevented())return this;e.zoomIn=!1;e.scale=1;d.data().noCenter=!1;c.unbind(f.mouseEvents.down,g._eMouseDown);c.unbind(f.mouseEvents.move,g._eMouseMove);f(document).unbind(f.mouseEvents.up,e.mouseupEvent);c.unbind("mousewheel",g._eMouseWheel);h={};h[k+"transition"]=k+"transform "+e.opts.easeFunction+
" "+a+"ms";d.css(h);var l=f("<div />",{css:{position:"relative",top:e.flipPosition.y,left:e.flipPosition.x,width:d.width()*m,height:d.height()*m,background:"blue"}}).appendTo(d.parent()),h=i(l.offset().left-b.left,l.offset().top-b.top);l.remove();var p=d.data().opts.autoCenter;p&&"double"==d.turn("display")&&(d.turn("view")[0]?d.turn("view")[1]||(h.x+=l.width()/4):h.x-=l.width()/4);var q=f.findPos(d[0]);b=i(-d.width()/2-q.left+l.width()/2+h.x+b.left,-d.height()/2-q.top+l.height()/2+h.y+b.top);var n=
function(){if(d[0].style.removeProperty){d[0].style.removeProperty(k+"transition");d.transform(d.turn("options").acceleration?s(0,0,true):"").turn("zoom",1);d[0].style.removeProperty("margin");d.css({position:"relative",top:e.flipPosition.y,left:e.flipPosition.x})}else d.transform("none").turn("zoom",1).css({margin:"",top:e.flipPosition.y,left:e.flipPosition.x,position:"relative"});p&&d.turn("center");c.trigger("zoom.zoomOut")};0===a?n():(j?d.bind(j,function(){f(this).unbind(j);n()}):setTimeout(n,
a),d.transform(s(b.x,b.y,!0)+u(m,!0)));return this}},flipbookWidth:function(){var a=this.data().zoom.opts.flipbook,b=a.turn("view");return"double"==a.turn("display")&&(!b[0]||!b[1])?a.width()/2:a.width()},scroll:function(a,b,c){var e=this.data().zoom,d=e.opts.flipbook,g=this.zoom("flipbookWidth"),k=f.cssPrefix();if(p){var j={};j[k+"transition"]=c?k+"transform 200ms":"none";d.css(j);d.transform(s(-e.axis.x-a.x,-e.axis.y-a.y,!0))}else d.css({top:-e.axis.y-a.y,left:-e.axis.x-a.x});if(!b){var h,b=i(Math.min(0,
(g-this.width())/2),Math.min(0,(d.height()-this.height())/2)),d=i(g>this.width()?g-this.width():(g-this.width())/2,d.height()>this.height()?d.height()-this.height():(d.height()-this.height())/2);a.y<b.y?(a.y=b.y,h=!0):a.y>d.y&&(a.y=d.y,h=!0);a.x<b.x?(a.x=b.x,h=!0):a.x>d.x&&(a.x=d.x,h=!0);h&&this.zoom("scroll",a,!0,!0)}e.scrollPos=i(a.x,a.y)},resize:function(){var a=this.data().zoom,b=a.opts.flipbook;if(1<this.zoom("value")){var c=b.offset(),e=this.offset();a.axis=i(c.left-e.left+(a.axis.x+a.scrollPos.x),
c.top-e.top+(a.axis.y+a.scrollPos.y));"double"==b.turn("display")&&!b.turn("view")[0]&&(a.axis.x+=b.width()/2);this.zoom("scroll",a.scrollPos)}},_eZoom:function(){for(var a=this.data().zoom,b=a.opts.flipbook,c=b.turn("view"),e=0;e<c.length;e++)c[e]&&this.trigger("zoom.resize",[a.scale,c[e],b.data().pageObjs[c[e]]])},_eStart:function(a){1!=this.zoom("value")&&a.preventDefault()},_eTurning:function(a,b,c){var e=this,a=this.zoom("value"),d=this.data().zoom,b=d.opts.flipbook;d.page=b.turn("page");if(1!=
a){for(d=0;d<c.length;d++)c[d]&&this.trigger("zoom.resize",[a,c[d],b.data().pageObjs[c[d]]]);setTimeout(function(){e.zoom("resize")},0)}},_eTurned:function(a,b){if(1!=this.zoom("value")){var c=this.data().zoom,e=c.opts.flipbook;b>c.page?this.zoom("scroll",i(0,c.scrollPos.y),!1,!0):b<c.page&&this.zoom("scroll",i(e.width(),c.scrollPos.y),!1,!0)}},_ePressed:function(){f(this).data().zoom.draggingCorner=!0},_eReleased:function(){var a=f(this).data().zoom;setTimeout(function(){a.draggingCorner=!1},1)},
_eMouseDown:function(a){f(this).data().zoom.draggingCur=f.isTouch?i(a.originalEvent.touches[0].pageX,a.originalEvent.touches[0].pageY):i(a.pageX,a.pageY);return!1},_eMouseMove:function(a){var b=f(this).data().zoom;if(b.draggingCur){b.dragging=!0;var a=f.isTouch?i(a.originalEvent.touches[0].pageX,a.originalEvent.touches[0].pageY):i(a.pageX,a.pageY),c=i(a.x-b.draggingCur.x,a.y-b.draggingCur.y);f(this).zoom("scroll",i(b.scrollPos.x-c.x,b.scrollPos.y-c.y),!0);b.draggingCur=a;return!1}},_eMouseUp:function(){var a=
f(this).data().zoom;a.dragging&&f(this).zoom("scroll",a.scrollPos);a.draggingCur=null;setTimeout(function(){a.dragging=!1},1)},_eMouseWheel:function(a,b,c,e){a=f(this).data().zoom;c=i(a.scrollPos.x+10*c,a.scrollPos.y-10*e);f(this).zoom("scroll",c,!1,!0)},_eTouchStart:function(a){var b=f(this).data().zoom,a=i(a.originalEvent.touches[0].pageX,a.originalEvent.touches[0].pageY);b.touch={};b.touch.initial=a;b.touch.last=a;b.touch.timestamp=(new Date).getTime();b.touch.speed=i(0,0)},_eTouchMove:function(a){var b=
f(this).data().zoom,c=f(this).zoom("value"),e=b.opts.flipbook,d=(new Date).getTime(),a=i(a.originalEvent.touches[0].pageX,a.originalEvent.touches[0].pageY);b.touch&&(1==c&&!e.data().mouseAction)&&(b.touch.motion=i(a.x-b.touch.last.x,a.y-b.touch.last.y),b.touch.speed.x=0===b.touch.speed.x?b.touch.motion.x/(d-b.touch.timestamp):(b.touch.speed.x+b.touch.motion.x/(d-b.touch.timestamp))/2,b.touch.last=a,b.touch.timestamp=d)},_eTouchEnd:function(){var a=f(this).data().zoom;if(a.touch&&1==f(this).zoom("value")){var b=
Math.abs(a.touch.initial.y-a.touch.last.y);50>b&&(-1>a.touch.speed.x||-100>a.touch.last.x-a.touch.initial.x)?this.trigger("zoom.swipeLeft"):50>b&&(1<a.touch.speed.x||100<a.touch.last.x-a.touch.initial.x)&&this.trigger("zoom.swipeRight")}},_eDestroying:function(){var a=this,b=this.data().zoom,c=b.opts.flipbook;this.zoom("zoomOut",0);f.each("tap doubleTap resize zoomIn zoomOut swipeLeft swipeRight".split(" "),function(b,c){a.unbind("zoom."+c)});for(var e in b.flipbookEvents)Object.prototype.hasOwnProperty.call(b.flipbookEvents,
e)&&c.unbind(e,b.flipbookEvents[e]);c.unbind("touchstart",b.eventTouchStart).unbind("touchmove",b.eventTouchMove).unbind("touchend",b.eventTouchEnd);this.unbind("touchstart",g._tap).unbind("click",g._tap);b=null;this.data().zoom=null}};f.extend(f.fn,{zoom:function(){var a=arguments;if(!a[0]||"object"==typeof a[0])return g.init.apply(f(this[0]),a);if(g[a[0]])return g[a[0]].apply(f(this[0]),Array.prototype.slice.call(a,1));throw t(a[0]+" is not a method");}})})(jQuery);
